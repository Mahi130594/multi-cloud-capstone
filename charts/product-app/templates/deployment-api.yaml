apiVersion: apps/v1 kind: Deployment metadata: name: {{ include "product-app.fullname" . }}-api labels: app.kubernetes.io/name: {{ include "product-app.name" . }} app.kubernetes.io/instance: {{ .Release.Name }} spec: replicas: {{ .Values.replicaCount.api }} selector: matchLabels: app: api release: {{ .Release.Name }} template: metadata: labels: app: api release: {{ .Release.Name }} spec: containers: - name: api image: "{{ .Values.image.api.repository }}:{{ .Values.image.api.tag }}" imagePullPolicy: {{ .Values.image.api.pullPolicy }} ports: - containerPort: {{ .Values.service.api.port }} env: - name: NODE_ENV value: "production" {{- if .Values.env.API_DATABASE_URL }} - name: DATABASE_URL value: "{{ .Values.env.API_DATABASE_URL }}" {{- end }} readinessProbe: httpGet: path: /health port: {{ .Values.service.api.port }} initialDelaySeconds: 5 periodSeconds: 10 livenessProbe: httpGet: path: /health port: {{ .Values.service.api.port }} initialDelaySeconds: 10 periodSeconds: 20 resources: {{ toYaml .Values.resources.api | nindent 12 }}
